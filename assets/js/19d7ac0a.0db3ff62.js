"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4051],{6275:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>p,toc:()=>a});var o=n(4848),t=n(8453);const s={},i="protobuf",p={id:"espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/protobuf",title:"protobuf",description:"\u5b89\u88c5",source:"@site/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/protobuf.md",sourceDirName:"espressif/\u4e2a\u4eba\u5b66\u4e60/IDF",slug:"/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/protobuf",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/protobuf",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/protobuf.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"modbus serial slave",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4ece\u673a"},next:{title:"SPIFFS Filesystem",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/spiffs"}},l={},a=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u521d\u6b65\u4f7f\u7528",id:"\u521d\u6b65\u4f7f\u7528",level:2},{value:"1.\u5148\u5199\u4e00\u4e2aproto\u6587\u4ef6",id:"1\u5148\u5199\u4e00\u4e2aproto\u6587\u4ef6",level:3},{value:"2.\u5199cmakelist",id:"2\u5199cmakelist",level:3},{value:"3.\u7f16\u7801\u4e0e\u89e3\u7801",id:"3\u7f16\u7801\u4e0e\u89e3\u7801",level:3},{value:"Linux\u73af\u5883\u4e0b\u5b89\u88c5",id:"linux\u73af\u5883\u4e0b\u5b89\u88c5",level:2},{value:"\u5b89\u88c5protobuf-c",id:"\u5b89\u88c5protobuf-c",level:3},{value:"Python\u5bfc\u51faprotobuf py",id:"python\u5bfc\u51faprotobuf-py",level:2}];function c(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.h1,{id:"protobuf",children:"protobuf"}),"\n",(0,o.jsx)(r.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"brew install protobuf\r\nbrew install protobuf-c\r\n\r\nprotoc --version\n"})}),"\n",(0,o.jsx)(r.h2,{id:"\u521d\u6b65\u4f7f\u7528",children:"\u521d\u6b65\u4f7f\u7528"}),"\n",(0,o.jsx)(r.h3,{id:"1\u5148\u5199\u4e00\u4e2aproto\u6587\u4ef6",children:"1.\u5148\u5199\u4e00\u4e2aproto\u6587\u4ef6"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-proto",children:'syntax = "proto2";\r\n\r\nmessage Person {\r\n  required string name = 1;\r\n  required int32 id = 2;\r\n  required bytes portrait = 3;\r\n  optional string email = 4;\r\n}\n'})}),"\n",(0,o.jsx)(r.p,{children:"\u5176\u4e2d\u7b2c\u4e09\u4e2a\u90e8\u5206\u662f\u5b58\u653e\u4e86\u4e00\u4e2a\u6570\u7ec4\uff0c\u4e0a\u9762\u7684syntax\u662f\u5fc5\u8981\u7684\uff0c\u6307\u5b9aprotobuf\u7684\u7248\u672c"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"(base) \u279c  protobuf protoc --c_out=. person.proto\n"})}),"\n",(0,o.jsx)(r.h3,{id:"2\u5199cmakelist",children:"2.\u5199cmakelist"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-cmake",children:'cmake_minimum_required(VERSION 3.25)\r\nproject(protobuf C)\r\n\r\nset(CMAKE_C_STANDARD 11)\r\nset(INC_DIRS "protobuf/include")\r\nfile(GLOB SOURCES "protobuf/*.c")\r\n\r\nfind_package(PkgConfig REQUIRED)\r\npkg_check_modules(PROTOBUF_C REQUIRED libprotobuf-c>=1.0.0)\r\n\r\nadd_executable(protobuf main.c ${SOURCES})\r\ninclude_directories(${INC_DIRS} ${PROTOBUF_C_INCLUDE_DIRS})\r\n\r\ntarget_compile_options(protobuf PRIVATE ${PROTOBUF_C_CFLAGS})\r\ntarget_link_libraries(protobuf PRIVATE ${PROTOBUF_C_LDFLAGS})\n'})}),"\n",(0,o.jsx)(r.h3,{id:"3\u7f16\u7801\u4e0e\u89e3\u7801",children:"3.\u7f16\u7801\u4e0e\u89e3\u7801"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-c",children:'#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <string.h>\r\n#include "person.pb-c.h"\r\n\r\n\r\nint main() {\r\n    uint8_t test_image[] = {1,2,3};\r\n\r\n    Person p = PERSON__INIT;\r\n    p.name = "yanke";\r\n    p.id = 12345;\r\n    p.email = "yanke@zjut.edu.cn";\r\n    p.portrait.data = test_image;\r\n    p.portrait.len = sizeof(test_image);\r\n\r\n    // \u5e8f\u5217\u5316\u6d88\u606f\r\n    size_t len;\r\n    uint8_t *buffer;\r\n    len = person__get_packed_size(&p);\r\n    buffer = malloc(len);\r\n    person__pack(&p, buffer);\r\n\r\n    printf("Serialized data length: %zu\\n", len);\r\n\r\n    // \u53cd\u5e8f\u5217\u5316\u6d88\u606f\r\n    Person *unpacked_person;\r\n    unpacked_person = person__unpack(NULL, len, buffer);\r\n\r\n    if (unpacked_person == NULL) {\r\n        fprintf(stderr, "Error unpacking message\\n");\r\n        free(buffer);\r\n        return 1;\r\n    }\r\n\r\n    printf("Name: %s\\n", unpacked_person->name);\r\n    printf("ID: %d\\n", unpacked_person->id);\r\n    if (unpacked_person->email != NULL) {\r\n        printf("Email: %s\\n", unpacked_person->email);\r\n    } else {\r\n        printf("Email: not set\\n");\r\n    }\r\n\r\n    // \u6253\u5370\u56fe\u50cf\u6570\u636e\u5927\u5c0f\u548c\u5185\u5bb9\r\n    printf("Image data size: %zu\\n", unpacked_person->portrait.len);\r\n    printf("Image data: ");\r\n    for (size_t i = 0; i < unpacked_person->portrait.len; i++) {\r\n        printf("%u ", unpacked_person->portrait.data[i]);\r\n    }\r\n    printf("\\n");\r\n\r\n    // \u91ca\u653e\u5185\u5b58\r\n    person__free_unpacked(unpacked_person, NULL);\r\n    free(buffer);\r\n    return 0;\r\n}\r\n\n'})}),"\n",(0,o.jsx)(r.h2,{id:"linux\u73af\u5883\u4e0b\u5b89\u88c5",children:"Linux\u73af\u5883\u4e0b\u5b89\u88c5"}),"\n",(0,o.jsx)(r.h3,{id:"\u5b89\u88c5protobuf-c",children:"\u5b89\u88c5protobuf-c"}),"\n",(0,o.jsxs)(r.p,{children:["\u6709\u4e00\u7bc7\u53c2\u8003\u7684\u6587\u7ae0\uff1a",(0,o.jsx)(r.a,{href:"https://blog.csdn.net/weixin_38331755/article/details/123029555?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ECtr-1-123029555-blog-115771236.235%5Ev43%5Epc_blog_bottom_relevance_base5&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ECtr-1-123029555-blog-115771236.235%5Ev43%5Epc_blog_bottom_relevance_base5&utm_relevant_index=2",children:"Linux\u5b89\u88c5\u8fc7\u7a0b"})]}),"\n",(0,o.jsx)(r.p,{children:"\u8fd9\u91cc\u63a8\u8350\u7684\u7248\u672c\u662f\uff1a\r\nprotobuf: 3.19.4\r\nprotobuf-c: 1.3.3"}),"\n",(0,o.jsx)(r.p,{children:"\u6211\u4eec\u8fd9\u91cc\u7528\u7684\u662fzsh\uff0c\u6240\u4ee5\u914d\u7f6e\u5982\u4e0b\uff1a"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:'export PATH="$PATH:/usr/local/protobuf-3.19.4/bin"\r\nexport PKG_CONFIG_PATH=/usr/local/protobuf-3.19.4/lib/pkgconfig\r\nexport PATH="$PATH:/usr/local/protobuf-c-1.3.3/bin"\n'})}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"\u279c  proto git:(feature/add_esp_video_protobuf_ctrl) \u2717 protoc-c --c_out=. esp_video_protobuf_protocols.proto \n"})}),"\n",(0,o.jsx)(r.h2,{id:"python\u5bfc\u51faprotobuf-py",children:"Python\u5bfc\u51faprotobuf py"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"(pyqt5) PS D:\\project\\isp\\esp-isp-tool\\protobuf> protoc --python_out=. .\\protocols.proto\n"})})]})}function u(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>p});var o=n(6540);const t={},s=o.createContext(t);function i(e){const r=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function p(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(s.Provider,{value:r},e.children)}}}]);