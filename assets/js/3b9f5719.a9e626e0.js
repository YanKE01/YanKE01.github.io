"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5095],{411:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>a,contentTitle:()=>s,default:()=>I,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var _=e(4848),t=e(8453);const i={},s="USB HID \u9f20\u6807\u5b9e\u6218",c={id:"espressif/\u4e2a\u4eba\u5b66\u4e60/\u5916\u8bbe/USB/usb_device_mouse",title:"USB HID \u9f20\u6807\u5b9e\u6218",description:"\u62a5\u544a\u63cf\u8ff0\u7b26\u683c\u5f0f",source:"@site/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/\u5916\u8bbe/USB/usb_device_mouse.md",sourceDirName:"espressif/\u4e2a\u4eba\u5b66\u4e60/\u5916\u8bbe/USB",slug:"/espressif/\u4e2a\u4eba\u5b66\u4e60/\u5916\u8bbe/USB/usb_device_mouse",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/\u5916\u8bbe/USB/usb_device_mouse",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/\u5916\u8bbe/USB/usb_device_mouse.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"USB HID Consumer",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/\u5916\u8bbe/USB/usb_device_consumer"},next:{title:"USB MSC",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/\u5916\u8bbe/USB/usb_device_msc"}},a={},d=[{value:"\u62a5\u544a\u63cf\u8ff0\u7b26\u683c\u5f0f",id:"\u62a5\u544a\u63cf\u8ff0\u7b26\u683c\u5f0f",level:3},{value:"TinyUsb\u62a5\u544a\u63cf\u8ff0\u7b26\u89e3\u6790",id:"tinyusb\u62a5\u544a\u63cf\u8ff0\u7b26\u89e3\u6790",level:3},{value:"\u9f20\u6807\u62a5\u544a\u63cf\u8ff0\u7b26",id:"\u9f20\u6807\u62a5\u544a\u63cf\u8ff0\u7b26",level:3},{value:"\u5b8c\u6574\u7684\u914d\u7f6e\u63cf\u8ff0\u7b26",id:"\u5b8c\u6574\u7684\u914d\u7f6e\u63cf\u8ff0\u7b26",level:3},{value:"\u5de5\u7a0b\u6e90\u4ee3\u7801",id:"\u5de5\u7a0b\u6e90\u4ee3\u7801",level:3},{value:"ref",id:"ref",level:3}];function o(n){const r={a:"a",code:"code",h1:"h1",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(r.h1,{id:"usb-hid-\u9f20\u6807\u5b9e\u6218",children:"USB HID \u9f20\u6807\u5b9e\u6218"}),"\n",(0,_.jsx)(r.h3,{id:"\u62a5\u544a\u63cf\u8ff0\u7b26\u683c\u5f0f",children:"\u62a5\u544a\u63cf\u8ff0\u7b26\u683c\u5f0f"}),"\n",(0,_.jsx)(r.p,{children:"\u9996\u5148\uff0c\u4e00\u4e2a\u62a5\u544a\u63cf\u8ff0\u7b26\u5185\u90e8\u7684\u4f18\u5148\u7ea7\u5e94\u8be5\u662fGlobal item -> Local item -> Main item"}),"\n",(0,_.jsxs)(r.ul,{children:["\n",(0,_.jsx)(r.li,{children:"Usage Page:\u6307\u5b9a\u8bbe\u5907\u529f\u80fd\uff0c\u5728USH_HID\u4e2d\u6587\u7684189\u9875\uff0c\u9009\u62e90x01\uff0c\u901a\u7528\u684c\u9762\u63a7\u5236"}),"\n",(0,_.jsx)(r.li,{children:"Usage: \u6307\u5b9a\u4e2a\u522b\u62a5\u8868\u7684\u529f\u80fd\uff0c\u662fUsage Page\u7684\u4e0b\u4e00\u7ea7\uff0c\u6211\u4eec\u4e0a\u9762\u9009\u62e9\u7684\u662f0x01\uff0c\u6211\u4eec\u7684\u7528\u9014\u662f\u9f20\u6807\uff0c\u53c2\u8003P190\uff0c\u9009\u62e9mouse\uff0c\u4e3a0x02"}),"\n",(0,_.jsxs)(r.li,{children:["Collection and End Collection: \u76f8\u5f53\u4e8e\u96c6\u5408\u7684\u610f\u601d","\n",(0,_.jsxs)(r.ul,{children:["\n",(0,_.jsx)(r.li,{children:"Application Collection: 1\uff0c\u5c31\u662f\u5305\u542b\u5171\u540c\u7528\u9014\u7684\u9879\u76ee\u6216\u8005\u5355\u4e00\u529f\u80fd\u7684\u9879\u76ee\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u952e\u76d8\u7684\u5f00\u673a\u662f\u6309\u952e\u548cled\u706f\u7684\u5171\u540c\u7528\u9014"}),"\n",(0,_.jsx)(r.li,{children:"Physical Collection: 0\uff0c\u4e00\u4e2a\u5355\u4e00\u51e0\u4f55\u70b9\u4e0a\u7684\u6570\u636e\u9879\u76ee"}),"\n",(0,_.jsx)(r.li,{children:"Logical Collection: 2\uff0c\u4ee5\u540e\u4e86\u89e3"}),"\n"]}),"\n"]}),"\n",(0,_.jsx)(r.li,{children:"LogicalMax and LogicalMin\uff1a\u5b9a\u4e49\u62a5\u8868\u53d8\u91cf\u7684\u6570\u636e\u8303\u56f4\uff0c\u5728\u6211\u4eec\u8fd9\u4e2a\u9f20\u6807\u6309\u952e\u91cc\uff0c\u53ea\u67090\u548c1"}),"\n",(0,_.jsxs)(r.li,{children:["ReportCount\uff1a\u6307\u5b9alocal uage\u7684\u4e2a\u6570 ",(0,_.jsx)(r.a,{href:"https://www.usbzh.com/article/detail-966.html",children:"https://www.usbzh.com/article/detail-966.html"})]}),"\n",(0,_.jsx)(r.li,{children:"ReportSize\uff1a\u6307\u5b9a\u6bcf\u4e00\u4e2ausage\u7684\u6570\u636e\u5927\u5c0f"}),"\n"]}),"\n",(0,_.jsx)(r.h3,{id:"tinyusb\u62a5\u544a\u63cf\u8ff0\u7b26\u89e3\u6790",children:"TinyUsb\u62a5\u544a\u63cf\u8ff0\u7b26\u89e3\u6790"}),"\n",(0,_.jsx)(r.pre,{children:(0,_.jsx)(r.code,{className:"language-c",children:"HID_USAGE_PAGE ( HID_USAGE_PAGE_DESKTOP      )\n"})}),"\n",(0,_.jsx)(r.p,{children:"\u6211\u4eec\u5c55\u5f00,\u5176\u4e2d HID_USAGE_PAGE_DESKTOP= 0x01"}),"\n",(0,_.jsx)(r.pre,{children:(0,_.jsx)(r.code,{className:"language-c",children:"#define HID_USAGE_PAGE(x)         HID_REPORT_ITEM(x, RI_GLOBAL_USAGE_PAGE, RI_TYPE_GLOBAL, 1)\n"})}),"\n",(0,_.jsx)(r.p,{children:"\u5176\u4e2d RI_GLOBAL_USAGE_PAGE=0\uff0cRI_TYPE_GLOBAL=1"}),"\n",(0,_.jsx)(r.pre,{children:(0,_.jsx)(r.code,{className:"language-c",children:"#define HID_REPORT_DATA_1(data) , data\r\n#define HID_REPORT_ITEM(data, tag, type, size) \\\r\n  (((tag) << 4) | ((type) << 2) | (size)) HID_REPORT_DATA_##size(data)\n"})}),"\n",(0,_.jsx)(r.pre,{children:(0,_.jsx)(r.code,{className:"language-C",children:"(((0) << 4) | ((1) << 2) | (1)) HID_REPORT_DATA_##size(0X01)\n"})}),"\n",(0,_.jsx)(r.p,{children:"\u8fd9\u4e2a\u7ed3\u679c\u8d77\u59cb\u5c31\u662f 0x05,0x01\uff0c\u5bf9\u5e94Global Generic Desktop"}),"\n",(0,_.jsx)(r.h3,{id:"\u9f20\u6807\u62a5\u544a\u63cf\u8ff0\u7b26",children:"\u9f20\u6807\u62a5\u544a\u63cf\u8ff0\u7b26"}),"\n",(0,_.jsx)(r.pre,{children:(0,_.jsx)(r.code,{className:"language-c",children:"#define TUD_HID_REPORT_DESC_MOUSE(...) \\\r\n   HID_USAGE_PAGE(HID_USAGE_PAGE_DESKTOP),            /*!< \u9009\u62e9\u901a\u7528\u684c\u9762\u63a7\u5236 */\r\n    HID_USAGE(HID_USAGE_DESKTOP_MOUSE),                /*!< \u9009\u62e9\u9f20\u6807 */\r\n    HID_COLLECTION(HID_COLLECTION_APPLICATION),        /*!< \u521b\u5efa\u4e00\u4e2a\u529f\u80fd\u96c6\u5408 */\r\n    HID_REPORT_ID(HID_ITF_PROTOCOL_MOUSE)\r\n    HID_USAGE(HID_USAGE_DESKTOP_POINTER),              /*!< \u9009\u62e9\u6307\u9488*/\r\n    HID_COLLECTION(HID_COLLECTION_PHYSICAL),           /*!< \u521b\u5efa\u6570\u636e\u96c6\u5408 */\r\n    // \u8bbe\u7f6e\u6309\u952e\r\n    HID_USAGE_PAGE(HID_USAGE_PAGE_BUTTON),             /*!< \u5f00\u59cb\u8bbe\u7f6e\u9f20\u6807\u4e0a\u7684\u6309\u952e */\r\n    HID_USAGE_MIN(1),\r\n    HID_USAGE_MAX(3),                                  /*!< \u4e00\u5171\u8bbe\u7f6e\u4e86\u4e09\u4e2a\u6309\u952e\uff0c\u5206\u522b\u662f\u5de6\u53f3\u4e2d */\r\n    HID_LOGICAL_MIN(0),\r\n    HID_LOGICAL_MAX(1),                                /*!< \u6309\u952e\u7684\u6570\u636e\u8303\u56f4\u53ea\u67090\u548c1 */\r\n    HID_REPORT_COUNT(3),                               /*!< \u8fd9\u91cc\u4e00\u5171\u4e09\u4e2ausage\uff0c\u5c31\u662f\u4e4b\u524d\u5bf9\u5e94\u548c\u4e09\u4e2a\u6309\u952e */\r\n    HID_REPORT_SIZE(1),                                /*!< \u8fd9\u91cc\u6307\u7684\u662f\u6bcf\u4e00\u4e2ausage\u7684\u5927\u5c0f\uff0c\u56e0\u4e3a\u53ea\u67090\u548c1\uff0c\u6240\u4ee5\u53ea\u53601\u4f4d */\r\n    HID_INPUT(HID_DATA | HID_VARIABLE | HID_ABSOLUTE), /*!< \u6570\u636e\u7c7b\u578b */\r\n    HID_REPORT_COUNT(1),\r\n    HID_REPORT_SIZE(5),                                /*!< \u524d\u9762\u4e09\u4e2a\u6309\u952e\u4e00\u5171\u4e09\u4e2abit\uff0c\u6211\u4eec\u8981\u51d1\u4e00\u4e2a\u5b57\u8282 */\r\n    HID_INPUT(HID_CONSTANT),                           /*!< \u8fd9\u91cc\u7684\u6570\u636e\u7c7b\u578b\u968f\u4fbf */\r\n    // \u8bbe\u7f6ex\u548cy\u8f74\r\n    HID_USAGE_PAGE(HID_USAGE_PAGE_DESKTOP),\r\n    HID_USAGE(HID_USAGE_DESKTOP_X),\r\n    HID_USAGE(HID_USAGE_DESKTOP_Y),                    /*!< \u4e00\u5171\u8bbe\u7f6e\u4e86x\u548cy\u8f74 */\r\n    HID_LOGICAL_MIN(0x81),\r\n    HID_LOGICAL_MAX(0x7f),                             /*!< \u8fd9\u91cc\u8bbe\u7f6e\u4e86x\u8f74\u548cy\u8f74\u7684\u8303\u56f4\uff1a-127\u5230128 */\r\n    HID_REPORT_COUNT(2),                               /*!< \u53ea\u6709\u4e24\u4e2ausage */\r\n    HID_REPORT_SIZE(8),                                /*!< \u6bcf\u4e00\u4e2ausage\u7684\u5927\u5c0f\u4e3a\u4e00\u4e2a\u5b57\u8282 */\r\n    HID_INPUT(HID_DATA | HID_VARIABLE | HID_RELATIVE), /*!< \u9f20\u6807\u79fb\u52a8\u662f\u76f8\u5bf9\u7684 */\r\n    HID_COLLECTION_END,\r\n    HID_COLLECTION_END\n"})}),"\n",(0,_.jsx)(r.p,{children:"\u8fd9\u4e2a\u62a5\u544aID\u4e00\u5b9a\u8981\u52a0HID_REPORT_ID(HID_ITF_PROTOCOL_MOUSE)\uff0c\u4e0d\u7136\u5e95\u5c42\u4e0d\u80fd\u533a\u5206\r\n\u5176\u6b21\uff0c\u6211\u4eec\u8fd9\u91cc\u53ea\u662f\u4e0a\u62a5\u4e86\u4e09\u4e2a\u6570\u636e\uff1a\u6309\u952e\u3001X\u8f74\u4e0eY\u8f74\uff0c\u6240\u4ee5\u5728\u6700\u540e\u7684\u6570\u636e\u4e0a\u4f20\u65f6\uff0c\u4e0a\u62a5\u7684\u6570\u7ec4\u4e3a\u4e09\u4e2a"}),"\n",(0,_.jsx)(r.pre,{children:(0,_.jsx)(r.code,{className:"language-c",children:"bool tud_mouse_report(int8_t x,int8_t y)\r\n{\r\n    int8_t data[3] = {0X00, x, y};\r\n    return tud_hid_report(HID_ITF_PROTOCOL_MOUSE,data,sizeof(data));\r\n}\n"})}),"\n",(0,_.jsx)(r.h3,{id:"\u5b8c\u6574\u7684\u914d\u7f6e\u63cf\u8ff0\u7b26",children:"\u5b8c\u6574\u7684\u914d\u7f6e\u63cf\u8ff0\u7b26"}),"\n",(0,_.jsx)(r.pre,{children:(0,_.jsx)(r.code,{className:"language-c",children:"static const uint8_t hid_configuration_descriptor[] = {\r\n\r\n    //\u914d\u7f6e\u63cf\u8ff0\u7b26\r\n    0x09,                                         /*!< config:blength */\r\n    0x02,                                         /*!< config:bdescriptorType */\r\n    U16_TO_U8S_LE(9 + 1 * (9 + 9 + 7)),           /*!< config:wTotalLength, \u6240\u6709\u63cf\u8ff0\u7b26\u5927\u5c0f\u548c=\u914d\u7f6e\u63cf\u8ff0\u7b26\u5927\u5c0f+hid\u63a5\u53e3\u6570*(\u63a5\u53e3\u63cf\u8ff0\u7b26+HID\u63cf\u8ff0\u7b26+\u7aef\u70b9\u63cf\u8ff0\u7b26) */\r\n    1,                                            /*!< config:bNumInterfaces,\u53ea\u6709\u4e00\u4e2a\u63a5\u53e3\u63cf\u8ff0\u7b26 */\r\n    1,                                            /*!< config:bConfigurationValue,\u53ea\u6709\u4e00\u4e2a\u914d\u7f6e\u63cf\u8ff0\u7b26 */\r\n    0,                                            /*!< config:iConfiguration,\u53ea\u67091\u4e2a\u914d\u7f6e\u63cf\u8ff0\u7b26\uff0c\u6240\u4ee5\u7d22\u5f15\u4e3a0 */\r\n    0xA0,                                         /*!< config:bmAttributes,\u4f9b\u7535\u6a21\u5f0f\uff0c10100000,\u652f\u6301\u8fdc\u7a0b\u5524\u9192 */\r\n    0x32,                                         /*!< config:maxpower,\u8bbe\u7f6e\u7684\u4e3a\u9700\u8981100ma\uff0c\u6240\u4ee5\u586b\u768450 */\r\n\r\n    //\u63a5\u53e3\u63cf\u8ff0\u7b26\r\n    0x09,                                         /*!< interface:blength \u63cf\u8ff0\u7b26\u957f\u5ea6*/\r\n    0x04,                                         /*!< interface:bDescriptorType \u63cf\u8ff0\u7b26\u7c7b\u578b*/\r\n    0x00,                                         /*!< interface:bInterfaceNumber \u63a5\u53e3\u7f16\u53f7,\u4ece0\u5f00\u59cb\u9012\u589e*/\r\n    0x00,                                         /*!< interface:bAlternateSetting \u5907\u7528\u63a5\u53e3\u7f16\u53f7\uff0c\u5f88\u5c11\u7528\uff0c\u8bbe\u7f6e\u4e3a0*/\r\n    0x01,                                         /*!< interface:bNumEndpoints \u7aef\u70b9\u6570 */\r\n    0x03,                                         /*!< interface:bInterfaceClass \u63a5\u53e3\u7c7b\u578b\uff0cHID\u4e3a3 */\r\n    0x00,                                         /*!< interface:bInterfaceSubClass \u5b50\u7c7b\u578b 0\u8868\u793a\u4e3a\u672a\u5b9a\u4e49 */\r\n    0x00,                                         /*!< interface:bInterfaceProtocol */\r\n    0x00,                                         /*!< interface:iInterface \u63a5\u53e3\u5b57\u7b26\u4e32\u7d22\u5f15\u503c\uff0c0\u8868\u793a\u65e0\u5b57\u7b26\u4e32 */\r\n\r\n    //HID\u63cf\u8ff0\u7b26\r\n    0x09,                                         /*!< HID\u63cf\u8ff0\u7b26\u957f\u5ea6 */\r\n    0X21,                                         /*!< \u63cf\u8ff0\u7b26\u7c7b\u578b: HID */\r\n    U16_TO_U8S_LE(0x0110),                        /*!< HID\u63cf\u8ff0\u7b26\u89c4\u8303\u7801  */\r\n    0x00,                                         /*!< HID\u63cf\u8ff0\u7b26\uff1a\u786c\u4ef6\u56fd\u5bb6\u7801\uff0c0\u8868\u793a\u4e0d\u8bf4\u660e */\r\n    0x01,                                         /*!< HID\u63cf\u8ff0\u7b26\uff1a\u7c7b\u522b\u63cf\u8ff0\u7b26\u4e2a\u6570\uff0c\u81f3\u5c11\u4e00\u4e2a */\r\n    0x22,                                         /*!< HID\u63cf\u8ff0\u7b26\uff1a\u63cf\u8ff0\u7b26\u7c7b\u578b\uff0c\u8fd9\u91cc\u662f\u62a5\u8868 */\r\n    U16_TO_U8S_LE(sizeof(hid_report_descriptor)), /*!< HID\u63cf\u8ff0\u7b26\uff1a\u62a5\u8868\u63cf\u8ff0\u7b26\u603b\u957f\u5ea6 */\r\n\r\n    //\u7aef\u70b9\u63cf\u8ff0\u7b26\r\n    0x07,                                         /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u957f\u5ea6 */\r\n    0x05,                                         /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u63cf\u8ff0\u7b26\u7c7b\u578b\u4e3a0x05 */\r\n    0x81,                                         /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u7aef\u70b9\u5730\u5740\uff0c0x81=10000001,\u7b2c7\u4f4d\u4e3a1\u8868\u793a\u8f93\u5165\uff0c\u4e00\u4e2a\u7aef\u70b9\uff0c\u591a\u4ee5d0-d3\u4e3a1 */\r\n    0x03,                                         /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u7aef\u70b9\u5c5e\u6027\uff0c\u4e2d\u65ad\u4f20\u8f93\uff0c00000011 */\r\n    U16_TO_U8S_LE(16),                            /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u6700\u5927\u5305\u957f\u5ea6 */\r\n    10,                                           /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u7aef\u70b9\u67e5\u8be2\u65f6\u95f4 */\r\n\r\n};\n"})}),"\n",(0,_.jsx)(r.h3,{id:"\u5de5\u7a0b\u6e90\u4ee3\u7801",children:"\u5de5\u7a0b\u6e90\u4ee3\u7801"}),"\n",(0,_.jsx)(r.pre,{children:(0,_.jsx)(r.code,{className:"language-c",children:'/*\r\n * SPDX-FileCopyrightText: 2022-2023 Espressif Systems (Shanghai) CO LTD\r\n *\r\n * SPDX-License-Identifier: Unlicense OR CC0-1.0\r\n */\r\n\r\n#include <stdlib.h>\r\n#include "esp_log.h"\r\n#include "freertos/FreeRTOS.h"\r\n#include "freertos/task.h"\r\n#include "tinyusb.h"\r\n#include "class/hid/hid_device.h"\r\n#include "driver/gpio.h"\r\n\r\n#define APP_BUTTON (GPIO_NUM_0) // Use BOOT signal by default\r\nstatic const char *TAG = "example";\r\n\r\n/**\r\n * @brief \u8bbe\u7f6e\u9f20\u6807\u7684\u62a5\u544a\u63cf\u8ff0\u7b26\r\n *\r\n */\r\nconst uint8_t hid_report_descriptor[] = {\r\n    HID_USAGE_PAGE(HID_USAGE_PAGE_DESKTOP),            /*!< \u9009\u62e9\u901a\u7528\u684c\u9762\u63a7\u5236 */\r\n    HID_USAGE(HID_USAGE_DESKTOP_MOUSE),                /*!< \u9009\u62e9\u9f20\u6807 */\r\n    HID_COLLECTION(HID_COLLECTION_APPLICATION),        /*!< \u521b\u5efa\u4e00\u4e2a\u529f\u80fd\u96c6\u5408 */\r\n    HID_REPORT_ID(HID_ITF_PROTOCOL_MOUSE)\r\n    HID_USAGE(HID_USAGE_DESKTOP_POINTER),              /*!< \u9009\u62e9\u6307\u9488*/\r\n    HID_COLLECTION(HID_COLLECTION_PHYSICAL),           /*!< \u521b\u5efa\u6570\u636e\u96c6\u5408 */\r\n    // \u8bbe\u7f6e\u6309\u952e\r\n    HID_USAGE_PAGE(HID_USAGE_PAGE_BUTTON),             /*!< \u5f00\u59cb\u8bbe\u7f6e\u9f20\u6807\u4e0a\u7684\u6309\u952e */\r\n    HID_USAGE_MIN(1),\r\n    HID_USAGE_MAX(3),                                  /*!< \u4e00\u5171\u8bbe\u7f6e\u4e86\u4e09\u4e2a\u6309\u952e\uff0c\u5206\u522b\u662f\u5de6\u53f3\u4e2d */\r\n    HID_LOGICAL_MIN(0),\r\n    HID_LOGICAL_MAX(1),                                /*!< \u6309\u952e\u7684\u6570\u636e\u8303\u56f4\u53ea\u67090\u548c1 */\r\n    HID_REPORT_COUNT(3),                               /*!< \u8fd9\u91cc\u4e00\u5171\u4e09\u4e2ausage\uff0c\u5c31\u662f\u4e4b\u524d\u5bf9\u5e94\u548c\u4e09\u4e2a\u6309\u952e */\r\n    HID_REPORT_SIZE(1),                                /*!< \u8fd9\u91cc\u6307\u7684\u662f\u6bcf\u4e00\u4e2ausage\u7684\u5927\u5c0f\uff0c\u56e0\u4e3a\u53ea\u67090\u548c1\uff0c\u6240\u4ee5\u53ea\u53601\u4f4d */\r\n    HID_INPUT(HID_DATA | HID_VARIABLE | HID_ABSOLUTE), /*!< \u6570\u636e\u7c7b\u578b */\r\n    HID_REPORT_COUNT(1),\r\n    HID_REPORT_SIZE(5),                                /*!< \u524d\u9762\u4e09\u4e2a\u6309\u952e\u4e00\u5171\u4e09\u4e2abit\uff0c\u6211\u4eec\u8981\u51d1\u4e00\u4e2a\u5b57\u8282 */\r\n    HID_INPUT(HID_CONSTANT),                           /*!< \u8fd9\u91cc\u7684\u6570\u636e\u7c7b\u578b\u968f\u4fbf */\r\n    // \u8bbe\u7f6ex\u548cy\u8f74\r\n    HID_USAGE_PAGE(HID_USAGE_PAGE_DESKTOP),\r\n    HID_USAGE(HID_USAGE_DESKTOP_X),\r\n    HID_USAGE(HID_USAGE_DESKTOP_Y),                    /*!< \u4e00\u5171\u8bbe\u7f6e\u4e86x\u548cy\u8f74 */\r\n    HID_LOGICAL_MIN(0x81),\r\n    HID_LOGICAL_MAX(0x7f),                             /*!< \u8fd9\u91cc\u8bbe\u7f6e\u4e86x\u8f74\u548cy\u8f74\u7684\u8303\u56f4\uff1a-127\u5230128 */\r\n    HID_REPORT_COUNT(2),                               /*!< \u53ea\u6709\u4e24\u4e2ausage */\r\n    HID_REPORT_SIZE(8),                                /*!< \u6bcf\u4e00\u4e2ausage\u7684\u5927\u5c0f\u4e3a\u4e00\u4e2a\u5b57\u8282 */\r\n    HID_INPUT(HID_DATA | HID_VARIABLE | HID_RELATIVE), /*!< \u9f20\u6807\u79fb\u52a8\u662f\u76f8\u5bf9\u7684 */\r\n    HID_COLLECTION_END,\r\n    HID_COLLECTION_END\r\n   // TUD_HID_REPORT_DESC_MOUSE(HID_REPORT_ID(HID_ITF_PROTOCOL_MOUSE)),\r\n};\r\n\r\n/**\r\n * @brief String descriptor\r\n */\r\nconst char *hid_string_descriptor[5] = {\r\n    // array of pointer to string descriptors\r\n    (char[]){0x09, 0x04},   /*!< support language is english */\r\n    "TinyUSB",              /*!< manufacturer */  \r\n    "TinyUSB Device",       /*!< product */ \r\n    "123456",               /*!< chip id */  \r\n    "Example HID interface",\r\n};\r\n\r\nstatic const uint8_t hid_configuration_descriptor[] = {\r\n\r\n    //\u914d\u7f6e\u63cf\u8ff0\u7b26\r\n    0x09,                                         /*!< config:blength */\r\n    0x02,                                         /*!< config:bdescriptorType */\r\n    U16_TO_U8S_LE(9 + 1 * (9 + 9 + 7)),           /*!< config:wTotalLength, \u6240\u6709\u63cf\u8ff0\u7b26\u5927\u5c0f\u548c=\u914d\u7f6e\u63cf\u8ff0\u7b26\u5927\u5c0f+hid\u63a5\u53e3\u6570*(\u63a5\u53e3\u63cf\u8ff0\u7b26+HID\u63cf\u8ff0\u7b26+\u7aef\u70b9\u63cf\u8ff0\u7b26) */\r\n    1,                                            /*!< config:bNumInterfaces,\u53ea\u6709\u4e00\u4e2a\u63a5\u53e3\u63cf\u8ff0\u7b26 */\r\n    1,                                            /*!< config:bConfigurationValue,\u53ea\u6709\u4e00\u4e2a\u914d\u7f6e\u63cf\u8ff0\u7b26 */\r\n    0,                                            /*!< config:iConfiguration,\u53ea\u67091\u4e2a\u914d\u7f6e\u63cf\u8ff0\u7b26\uff0c\u6240\u4ee5\u7d22\u5f15\u4e3a0 */\r\n    0xA0,                                         /*!< config:bmAttributes,\u4f9b\u7535\u6a21\u5f0f\uff0c10100000,\u652f\u6301\u8fdc\u7a0b\u5524\u9192 */\r\n    0x32,                                         /*!< config:maxpower,\u8bbe\u7f6e\u7684\u4e3a\u9700\u8981100ma\uff0c\u6240\u4ee5\u586b\u768450 */\r\n\r\n    //\u63a5\u53e3\u63cf\u8ff0\u7b26\r\n    0x09,                                         /*!< interface:blength \u63cf\u8ff0\u7b26\u957f\u5ea6*/\r\n    0x04,                                         /*!< interface:bDescriptorType \u63cf\u8ff0\u7b26\u7c7b\u578b*/\r\n    0x00,                                         /*!< interface:bInterfaceNumber \u63a5\u53e3\u7f16\u53f7,\u4ece0\u5f00\u59cb\u9012\u589e*/\r\n    0x00,                                         /*!< interface:bAlternateSetting \u5907\u7528\u63a5\u53e3\u7f16\u53f7\uff0c\u5f88\u5c11\u7528\uff0c\u8bbe\u7f6e\u4e3a0*/\r\n    0x01,                                         /*!< interface:bNumEndpoints \u7aef\u70b9\u6570 */\r\n    0x03,                                         /*!< interface:bInterfaceClass \u63a5\u53e3\u7c7b\u578b\uff0cHID\u4e3a3 */\r\n    0x00,                                         /*!< interface:bInterfaceSubClass \u5b50\u7c7b\u578b 0\u8868\u793a\u4e3a\u672a\u5b9a\u4e49 */\r\n    0x00,                                         /*!< interface:bInterfaceProtocol */\r\n    0x00,                                         /*!< interface:iInterface \u63a5\u53e3\u5b57\u7b26\u4e32\u7d22\u5f15\u503c\uff0c0\u8868\u793a\u65e0\u5b57\u7b26\u4e32 */\r\n\r\n    //HID\u63cf\u8ff0\u7b26\r\n    0x09,                                         /*!< HID\u63cf\u8ff0\u7b26\u957f\u5ea6 */\r\n    0X21,                                         /*!< \u63cf\u8ff0\u7b26\u7c7b\u578b: HID */\r\n    U16_TO_U8S_LE(0x0110),                        /*!< HID\u63cf\u8ff0\u7b26\u89c4\u8303\u7801  */\r\n    0x00,                                         /*!< HID\u63cf\u8ff0\u7b26\uff1a\u786c\u4ef6\u56fd\u5bb6\u7801\uff0c0\u8868\u793a\u4e0d\u8bf4\u660e */\r\n    0x01,                                         /*!< HID\u63cf\u8ff0\u7b26\uff1a\u7c7b\u522b\u63cf\u8ff0\u7b26\u4e2a\u6570\uff0c\u81f3\u5c11\u4e00\u4e2a */\r\n    0x22,                                         /*!< HID\u63cf\u8ff0\u7b26\uff1a\u63cf\u8ff0\u7b26\u7c7b\u578b\uff0c\u8fd9\u91cc\u662f\u62a5\u8868 */\r\n    U16_TO_U8S_LE(sizeof(hid_report_descriptor)), /*!< HID\u63cf\u8ff0\u7b26\uff1a\u62a5\u8868\u63cf\u8ff0\u7b26\u603b\u957f\u5ea6 */\r\n\r\n    //\u7aef\u70b9\u63cf\u8ff0\u7b26\r\n    0x07,                                         /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u957f\u5ea6 */\r\n    0x05,                                         /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u63cf\u8ff0\u7b26\u7c7b\u578b\u4e3a0x05 */\r\n    0x81,                                         /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u7aef\u70b9\u5730\u5740\uff0c0x81=10000001,\u7b2c7\u4f4d\u4e3a1\u8868\u793a\u8f93\u5165\uff0c\u4e00\u4e2a\u7aef\u70b9\uff0c\u591a\u4ee5d0-d3\u4e3a1 */\r\n    0x03,                                         /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u7aef\u70b9\u5c5e\u6027\uff0c\u4e2d\u65ad\u4f20\u8f93\uff0c00000011 */\r\n    U16_TO_U8S_LE(16),                            /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u6700\u5927\u5305\u957f\u5ea6 */\r\n    10,                                           /*!< \u7aef\u70b9\u63cf\u8ff0\u7b26\uff1a\u7aef\u70b9\u67e5\u8be2\u65f6\u95f4 */\r\n\r\n};\r\n\r\nuint8_t const *tud_hid_descriptor_report_cb(uint8_t instance)\r\n{\r\n    return hid_report_descriptor;\r\n}\r\n\r\nuint16_t tud_hid_get_report_cb(uint8_t instance, uint8_t report_id, hid_report_type_t report_type, uint8_t *buffer, uint16_t reqlen)\r\n{\r\n    (void)instance;\r\n    (void)report_id;\r\n    (void)report_type;\r\n    (void)buffer;\r\n    (void)reqlen;\r\n\r\n    return 0;\r\n}\r\n\r\nvoid tud_hid_set_report_cb(uint8_t instance, uint8_t report_id, hid_report_type_t report_type, uint8_t const *buffer, uint16_t bufsize)\r\n{\r\n}\r\n\r\n\r\ntypedef enum\r\n{\r\n    MOUSE_DIR_RIGHT,\r\n    MOUSE_DIR_DOWN,\r\n    MOUSE_DIR_LEFT,\r\n    MOUSE_DIR_UP,\r\n    MOUSE_DIR_MAX,\r\n} mouse_dir_t;\r\n\r\n#define DISTANCE_MAX 125\r\n#define DELTA_SCALAR 5\r\n\r\nstatic void mouse_draw_square_next_delta(int8_t *delta_x_ret, int8_t *delta_y_ret)\r\n{\r\n    static mouse_dir_t cur_dir = MOUSE_DIR_RIGHT;\r\n    static uint32_t distance = 0;\r\n\r\n    // Calculate next delta\r\n    if (cur_dir == MOUSE_DIR_RIGHT)\r\n    {\r\n        *delta_x_ret = DELTA_SCALAR;\r\n        *delta_y_ret = 0;\r\n    }\r\n    else if (cur_dir == MOUSE_DIR_DOWN)\r\n    {\r\n        *delta_x_ret = 0;\r\n        *delta_y_ret = DELTA_SCALAR;\r\n    }\r\n    else if (cur_dir == MOUSE_DIR_LEFT)\r\n    {\r\n        *delta_x_ret = -DELTA_SCALAR;\r\n        *delta_y_ret = 0;\r\n    }\r\n    else if (cur_dir == MOUSE_DIR_UP)\r\n    {\r\n        *delta_x_ret = 0;\r\n        *delta_y_ret = -DELTA_SCALAR;\r\n    }\r\n\r\n    // Update cumulative distance for current direction\r\n    distance += DELTA_SCALAR;\r\n    // Check if we need to change direction\r\n    if (distance >= DISTANCE_MAX)\r\n    {\r\n        distance = 0;\r\n        cur_dir++;\r\n        if (cur_dir == MOUSE_DIR_MAX)\r\n        {\r\n            cur_dir = 0;\r\n        }\r\n    }\r\n}\r\n\r\nbool tud_mouse_report(int8_t x,int8_t y)\r\n{\r\n    int8_t data[3] = {0X00, x, y};\r\n    return tud_hid_report(HID_ITF_PROTOCOL_MOUSE,data,sizeof(data));\r\n}\r\nstatic void app_send_hid_demo(void)\r\n{\r\n    // Mouse output: Move mouse cursor in square trajectory\r\n    ESP_LOGI(TAG, "Sending Mouse report");\r\n    int8_t delta_x;\r\n    int8_t delta_y;\r\n    for (int i = 0; i < (DISTANCE_MAX / DELTA_SCALAR) * 4; i++)\r\n    {\r\n        mouse_draw_square_next_delta(&delta_x, &delta_y);\r\n        tud_mouse_report(delta_x, delta_y);\r\n        vTaskDelay(pdMS_TO_TICKS(20));\r\n    }\r\n}\r\n\r\nvoid app_main(void)\r\n{\r\n    // Initialize button that will trigger HID reports\r\n    const gpio_config_t boot_button_config = {\r\n        .pin_bit_mask = BIT64(APP_BUTTON),\r\n        .mode = GPIO_MODE_INPUT,\r\n        .intr_type = GPIO_INTR_DISABLE,\r\n        .pull_up_en = true,\r\n        .pull_down_en = false,\r\n    };\r\n    ESP_ERROR_CHECK(gpio_config(&boot_button_config));\r\n\r\n    ESP_LOGI(TAG, "USB initialization");\r\n    const tinyusb_config_t tusb_cfg = {\r\n        .device_descriptor = NULL,\r\n        .string_descriptor = hid_string_descriptor,\r\n        .string_descriptor_count = sizeof(hid_string_descriptor) / sizeof(hid_string_descriptor[0]),\r\n        .external_phy = false,\r\n        .configuration_descriptor = hid_configuration_descriptor,\r\n    };\r\n\r\n    ESP_ERROR_CHECK(tinyusb_driver_install(&tusb_cfg));\r\n    ESP_LOGI(TAG, "USB initialization DONE");\r\n\r\n    while (1)\r\n    {\r\n        if (tud_mounted())\r\n        {\r\n            static bool send_hid_data = true;\r\n            if (send_hid_data)\r\n            {\r\n                app_send_hid_demo();\r\n            }\r\n            send_hid_data = !gpio_get_level(APP_BUTTON);\r\n        }\r\n        vTaskDelay(pdMS_TO_TICKS(100));\r\n    }\r\n}\n'})}),"\n",(0,_.jsx)(r.h3,{id:"ref",children:"ref"}),"\n",(0,_.jsx)(r.p,{children:(0,_.jsx)(r.a,{href:"https://www.usbzh.com/article/detail-327.html",children:"\u9f20\u6807\u62a5\u544a\u63cf\u8ff0\u7b26"})})]})}function I(n={}){const{wrapper:r}={...(0,t.R)(),...n.components};return r?(0,_.jsx)(r,{...n,children:(0,_.jsx)(o,{...n})}):o(n)}},8453:(n,r,e)=>{e.d(r,{R:()=>s,x:()=>c});var _=e(6540);const t={},i=_.createContext(t);function s(n){const r=_.useContext(i);return _.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function c(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),_.createElement(i.Provider,{value:r},n.children)}}}]);