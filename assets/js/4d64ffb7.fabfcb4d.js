"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[448],{2708:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>o,frontMatter:()=>a,metadata:()=>c,toc:()=>_});var t=s(4848),n=s(8453);const a={},i="modbus serial master",c={id:"espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4e3b\u673a",title:"modbus serial master",description:"\u5f00\u53d1\u73af\u5883",source:"@site/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4e3b\u673a.md",sourceDirName:"espressif/\u4e2a\u4eba\u5b66\u4e60/IDF",slug:"/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4e3b\u673a",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4e3b\u673a",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4e3b\u673a.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"IDF\u547d\u4ee4\u4f7f\u7528\u8bb0\u5f55",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/idf_use_record"},next:{title:"modbus serial slave",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4ece\u673a"}},d={},_=[{value:"Device parameters",id:"device-parameters",level:3},{value:"master\u8bfb\u53d6",id:"master\u8bfb\u53d6",level:3},{value:"Ref",id:"ref",level:3}];function m(e){const r={a:"a",code:"code",h1:"h1",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{id:"modbus-serial-master",children:"modbus serial master"}),"\n",(0,t.jsx)(r.p,{children:"\u5f00\u53d1\u73af\u5883"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"esp idf 5.1"}),"\n",(0,t.jsx)(r.li,{children:"esp-modbus 1.0.13"}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"device-parameters",children:"Device parameters"}),"\n",(0,t.jsx)(r.p,{children:"\u5bf9\u4e8emaster\u800c\u8a00\uff0c\u9700\u8981\u7406\u89e3\u7684\u4e3b\u8981\u662fdevice parameters\uff0c\u4e0b\u9762\u662f\u4e00\u4e2aparameters\u7684\u4f8b\u5b50"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-c",children:'enum\r\n{\r\n    CID_INPUT = 0,\r\n    CID_COIL,\r\n    CID_HOLDING,\r\n};\r\n\r\nconst mb_parameter_descriptor_t device_parameters[] = {\r\n    {CID_INPUT, (const char *)("INPUT"), (const char *)(""), 1, MB_PARAM_INPUT, 0x00, 5,\r\n     INPUT_OFFSET(input_value1), PARAM_TYPE_U16, sizeof(uint16_t), OPTS(0, 0, 0), PAR_PERMS_READ_WRITE_TRIGGER},\r\n    {CID_COIL, (const char *)("COIL"), (const char *)(""), 1, MB_PARAM_COIL, 0x00, 16,\r\n     COIL_OFFSET(coil_value1), PARAM_TYPE_U8, sizeof(uint8_t), OPTS(0, 0, 0), PAR_PERMS_READ_WRITE_TRIGGER},\r\n    {CID_HOLDING, (const char *)("HOLDING"), (const char *)(""), 1, MB_PARAM_HOLDING, 0x00, 5,\r\n     HOLDING_OFFSET(holding_value1), PARAM_TYPE_U16, sizeof(uint16_t), OPTS(0, 0, 0), PAR_PERMS_READ_WRITE_TRIGGER},\r\n};\n'})}),"\n",(0,t.jsx)(r.p,{children:"\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u8fd9\u8fb9\u5206\u522b\u5b9a\u4e49\u4e86\u8f93\u5165\u5bc4\u5b58\u5668\u3001\u7ebf\u5708\u4e0e\u4fdd\u6301\u5bc4\u5b58\u5668\uff0c\u5176\u4e2d\uff0c\u5173\u4e8emb_parameter_descriptor_t\u7684\u5b9a\u4e49\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-c",children:"typedef struct {\r\n    uint16_t            cid;                /*!< Characteristic cid */\r\n    const char*         param_key;          /*!< The key (name) of the parameter */\r\n    const char*         param_units;        /*!< The physical units of the parameter */\r\n    uint8_t             mb_slave_addr;      /*!< Slave address of device in the Modbus segment */\r\n    mb_param_type_t     mb_param_type;      /*!< Type of modbus parameter */\r\n    uint16_t            mb_reg_start;       /*!< This is the Modbus register address. This is the 0 based value. */\r\n    uint16_t            mb_size;            /*!< Size of mb parameter in registers */\r\n    uint16_t            param_offset;       /*!< Parameter name (OFFSET in the parameter structure) */\r\n    mb_descr_type_t     param_type;         /*!< Float, U8, U16, U32, ASCII, etc. */\r\n    mb_descr_size_t     param_size;         /*!< Number of bytes in the parameter. */\r\n    mb_parameter_opt_t  param_opts;         /*!< Parameter options used to check limits and etc. */\r\n    mb_param_perms_t    access;             /*!< Access permissions based on mode */\r\n} mb_parameter_descriptor_t;\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u5176\u4e2d\uff1a"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["mb_size: \u662f\u4f60\u8981\u8bfb\u53d6\u7684\u6570\u91cf","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"CID_INPUT\u8fd9\u4e2aparameters\u91cc\uff0c5\u5c31\u662f\u8981\u8bfb\u53d65\u4e2a\u8f93\u5165\u5bc4\u5b58\u5668"}),"\n",(0,t.jsx)(r.li,{children:"CID_COIL\u8fd9\u4e2aparameters\u91cc\uff0c16\u5c31\u662f\u8981\u8bfb\u53d616\u4e2a\u7ebf\u5708\uff0c\u6ce8\u610f\uff0c\u6bcf\u4e00\u4e2a\u7ebf\u5708\u53ea\u67091\u4e2a\u4f4d"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["param_size\uff1a\u662f\u6bcf\u4e00\u4e2a\u6570\u636e\u7684\u5b57\u8282\u6570","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"CID_INPUT\u91cc\uff0c\u6bcf\u4e00\u4e2a\u6570\u636e\u7684\u5927\u5c0f\u4e3a2\u4e2a\u5b57\u8282,\u540c\u65f6\u6570\u636e\u4fdd\u5b58\u7684\u7c7b\u578b\u4e5f\u662fuint16_t"}),"\n",(0,t.jsx)(r.li,{children:"CID_COIL\u91cc\uff0c\u6bcf\u4e00\u4e2a\u6570\u636e\u7684\u5927\u5c0f\u4e3a1\u4e2a\u5b57\u8282\uff0c\u5c31\u662fsizeof(uint8_t),\u4f46\u662f\u6211\u4eec\u4e0a\u9762\u5199\u7684\u662f16\u4e2a\u7ebf\u5708\uff0c\u6240\u4ee5\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u8981\u5199\u4e24\u4e2auint8_t\u6765\u5b58\u653e\u7ed3\u679c"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"master\u8bfb\u53d6",children:"master\u8bfb\u53d6"}),"\n",(0,t.jsx)(r.p,{children:"\u5bf9\u4e8e\u8bfb\u53d6\uff0c\u53ea\u9700\u8981\u9009\u62e9\u597ddevice parameters\u91cc\u7684cid\u5373\u53ef\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u8bfb\u53d6\u7ebf\u5708\u7684\u4f8b\u5b50"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-c",children:'esp_err_t modbus_master_read_coil_reg()\r\n{\r\n    esp_err_t err = mbc_master_get_cid_info(CID_COIL, &param_descriptor);\r\n    if ((err != ESP_ERR_NOT_FOUND) && (param_descriptor != NULL))\r\n    {\r\n        void *temp_data_ptr = master_get_param_data(param_descriptor);\r\n        assert(temp_data_ptr);\r\n        uint8_t type = 0;\r\n        uint8_t value[2] = {0};\r\n        err = mbc_master_get_parameter(CID_COIL, (char *)param_descriptor->param_key, (uint8_t *)&value, &type);\r\n        if (err == ESP_OK)\r\n        {\r\n            ESP_LOGI(TAG, "Coil: %d %d", (*(uint8_t *)&value[0]), *(uint8_t *)&value[1]);\r\n        }\r\n    }\r\n    return err;\r\n}\n'})}),"\n",(0,t.jsx)(r.p,{children:"\u6211\u4eec\u5728\u521a\u624d\u7684device parameters\u91cc\u5b9a\u4e49\u4e86\u8981\u8bfb16\u4e2a\u7ebf\u5708\uff0c\u8fd4\u56de\u7684\u6570\u636e\u6bcf\u4e00\u4e2a\u662fuint8_t\uff0c\u6240\u4ee5\u9700\u8981\u4e24\u4e2auint8_t\u7684\u6570\u636e\uff0c\u6240\u4ee5\u6211\u8fd9\u91cc\u5199\u4e00\u4e2a\u6570\u7ec4\u3002"}),"\n",(0,t.jsx)(r.p,{children:"\u5b9e\u9a8c\u6548\u679c\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{src:s(8452).A+"",width:"797",height:"309"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.img,{src:s(1568).A+"",width:"1280",height:"1707"})}),"\n",(0,t.jsx)(r.p,{children:"127\u5c31\u662f10000001"}),"\n",(0,t.jsx)(r.h3,{id:"ref",children:"Ref"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"https://blog.csdn.net/jiangchuan465/article/details/136086289",children:"https://blog.csdn.net/jiangchuan465/article/details/136086289"})})]})}function o(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}},1568:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/modbus_master_coil_pc-4d7127985a262f25b40f3191a2ffae25.jpg"},8452:(e,r,s)=>{s.d(r,{A:()=>t});const t=s.p+"assets/images/modbus_master_coil_result-14870ae9165e008201340c5696c36ca6.png"},8453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>c});var t=s(6540);const n={},a=t.createContext(n);function i(e){const r=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(a.Provider,{value:r},e.children)}}}]);