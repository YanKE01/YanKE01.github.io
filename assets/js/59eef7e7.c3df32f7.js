"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5138],{7289:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var r=t(4848),o=t(8453);const s={},i="\u5982\u4f55\u4f7f\u7528onnx\u6a21\u578b\u8fdb\u884c\u63a8\u7406",a={id:"espressif/\u4e2a\u4eba\u5b66\u4e60/DL/onnx_runtime",title:"\u5982\u4f55\u4f7f\u7528onnx\u6a21\u578b\u8fdb\u884c\u63a8\u7406",description:"1.\u5b89\u88c5",source:"@site/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/DL/onnx_runtime.md",sourceDirName:"espressif/\u4e2a\u4eba\u5b66\u4e60/DL",slug:"/espressif/\u4e2a\u4eba\u5b66\u4e60/DL/onnx_runtime",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/DL/onnx_runtime",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/DL/onnx_runtime.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u5982\u4f55\u5c06\u7ec4\u4ef6\u4e0a\u4f20\u5305\u7ba1\u7406\u5668",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/Components/\u5982\u4f55\u4e0a\u4f20\u5305\u7ba1\u7406\u5668"},next:{title:"TFLite Micro Mnist",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/DL/tflit_micro_mnist"}},l={},d=[{value:"1.\u5b89\u88c5",id:"1\u5b89\u88c5",level:3},{value:"2.\u8f6c\u6362\u53ca\u63a8\u7406",id:"2\u8f6c\u6362\u53ca\u63a8\u7406",level:3}];function c(e){const n={code:"code",h1:"h1",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"\u5982\u4f55\u4f7f\u7528onnx\u6a21\u578b\u8fdb\u884c\u63a8\u7406",children:"\u5982\u4f55\u4f7f\u7528onnx\u6a21\u578b\u8fdb\u884c\u63a8\u7406"}),"\n",(0,r.jsx)(n.h3,{id:"1\u5b89\u88c5",children:"1.\u5b89\u88c5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"pip install onnxruntime\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u51fa\u73b0protobuf\u7248\u672c\u8fc7\u4f4e\uff0c\u4ece\u65b0\u5b89\u88c5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"pip install protobuf==3.20.2\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2\u8f6c\u6362\u53ca\u63a8\u7406",children:"2.\u8f6c\u6362\u53ca\u63a8\u7406"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import tflite2onnx\r\nimport keras2onnx\r\nimport onnx\r\nimport tensorflow as tf\r\nimport onnxruntime\r\nfrom data.data_generate import *\r\n\r\nif __name__ == \'__main__\':\r\n\r\n    model = tf.keras.models.load_model("./log/weights-improvement-406-0.9826.h5")\r\n    onnx_model = keras2onnx.convert_keras(model,model.name)\r\n    onnx.save_model(onnx_model, "./log/model.onnx")\r\n\r\n    providers = [\'CPUExecutionProvider\']\r\n    test_model = onnxruntime.InferenceSession("./log/model.onnx",providers=providers)\r\n\r\n    feature, label = DataGenerateOnehotShuffle("data/mzp_data_c10_stride1000.csv", num_class=10)\r\n    x,y = feature[0],label[0]\r\n    x = np.expand_dims(x, axis=0).astype("float32")\r\n    print(x,y)\r\n\r\n    onnx_input = {test_model.get_inputs()[0].name:x}\r\n    outputs = test_model.run(None,onnx_input)\r\n\r\n    print(outputs)\n'})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var r=t(6540);const o={},s=r.createContext(o);function i(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);