"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1771],{3609:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>l,frontMatter:()=>_,metadata:()=>a,toc:()=>d});var n=s(4848),t=s(8453);const _={},i="modbus serial slave",a={id:"espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4ece\u673a",title:"modbus serial slave",description:"\u5f00\u53d1\u73af\u5883\uff1a",source:"@site/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4ece\u673a.md",sourceDirName:"espressif/\u4e2a\u4eba\u5b66\u4e60/IDF",slug:"/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4ece\u673a",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4ece\u673a",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4ece\u673a.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"modbus serial master",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/modbus\u4e32\u53e3\u4e3b\u673a"},next:{title:"protobuf",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/IDF/protobuf"}},o={},d=[{value:"1.mb_register_area_descriptor_t",id:"1mb_register_area_descriptor_t",level:3},{value:"2.\u7b49\u5f85\u4e3b\u673a\u8bfb\u53d6",id:"2\u7b49\u5f85\u4e3b\u673a\u8bfb\u53d6",level:3}];function c(e){const r={code:"code",h1:"h1",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{id:"modbus-serial-slave",children:"modbus serial slave"}),"\n",(0,n.jsx)(r.p,{children:"\u5f00\u53d1\u73af\u5883\uff1a"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"esp idf 5.1"}),"\n",(0,n.jsx)(r.li,{children:"esp-modbus 1.0.13"}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"1mb_register_area_descriptor_t",children:"1.mb_register_area_descriptor_t"}),"\n",(0,n.jsx)(r.p,{children:"\u5bf9\u4e8eslave\u800c\u8a00\uff0c\u6700\u91cd\u8981\u7684\u5b9a\u4e49\u4f60\u7684reg area"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-c",children:"// \u79bb\u6563\u8f93\u5165\u5bc4\u5b58\u5668\r\nmb_register_area_descriptor_t descrete_reg_area = {\r\n    .type = MB_PARAM_DISCRETE,\r\n    .start_offset = 0x0000,\r\n    .address = (void *)&discrete_reg_params,\r\n    .size = sizeof(discrete_reg_params_t),\r\n};\r\nESP_ERROR_CHECK(mbc_slave_set_descriptor(descrete_reg_area));\r\n\r\n// \u7ebf\u5708\r\nmb_register_area_descriptor_t coil_reg_area = {\r\n    .type = MB_PARAM_COIL,\r\n    .start_offset = 0x0000,\r\n    .address = (void *)&coil_reg_params,\r\n    .size = sizeof(coil_reg_params_t),\r\n};\r\nESP_ERROR_CHECK(mbc_slave_set_descriptor(coil_reg_area));\r\n\r\n// \u4fdd\u6301\u5bc4\u5b58\u5668\r\nmb_register_area_descriptor_t holding_reg_area = {\r\n    .type = MB_PARAM_HOLDING,\r\n    .start_offset = 0x0000,\r\n    .address = (void *)&holding_reg_params,\r\n    .size = sizeof(holding_reg_params_t),\r\n};\r\nESP_ERROR_CHECK(mbc_slave_set_descriptor(holding_reg_area));\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u8fd9\u91cc\u5b9a\u4e49\u4e86\u8f93\u5165\u5bc4\u5b58\u5668\uff0c\u4fdd\u6301\u5bc4\u5b58\u5668\u3001\u7ebf\u5708"}),"\n",(0,n.jsx)(r.p,{children:"\u5176\u4e2d\uff0c\u504f\u79fb\u9ed8\u8ba4\u4e3a0x0000\uff0c\u5982\u679c\u8981\u4fee\u6539\u7684\u8bdd\uff0c\u8bb0\u5f97\u540c\u6b65\u6539\u4e0a\u4f4d\u673a\u7684\u504f\u79fb\u5730\u5740"}),"\n",(0,n.jsx)(r.h3,{id:"2\u7b49\u5f85\u4e3b\u673a\u8bfb\u53d6",children:"2.\u7b49\u5f85\u4e3b\u673a\u8bfb\u53d6"}),"\n",(0,n.jsx)(r.p,{children:"\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\uff0c\u4e3b\u8981\u6839\u636eevent\u505a\u5bf9\u5e94\u7684\u52a8\u4f5c\u5c31\u884c"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-c",children:'while (1)\r\n{\r\n    mb_event_group_t event = mbc_slave_check_event(MB_READ_WRITE_MASK);\r\n\r\n    if (event & MB_EVENT_DISCRETE_RD)\r\n    {\r\n        // \u4e3b\u673a\u8bfb\u53d6\u79bb\u6563\u8f93\u5165\u5bc4\u5b58\u5668\r\n        ESP_ERROR_CHECK(mbc_slave_get_param_info(&reg_info, 10));\r\n        ESP_LOGI(TAG, "DISCRETE READ");\r\n    }\r\n    else if (event & MB_EVENT_COILS_RD)\r\n    {\r\n        // \u4e3b\u673a\u8bfb\u53d6\u7ebf\u5708\r\n        ESP_LOGI(TAG, "COIL READ");\r\n    }\r\n    else if (event & MB_EVENT_COILS_WR)\r\n    {\r\n        // \u4e3b\u673a\u5199\u7ebf\u5708\r\n        ESP_LOGI(TAG, "COIL WRITE");\r\n        ESP_LOGI(TAG, "Coil: %d %d", coil_reg_params.coils_port_0, coil_reg_params.coils_port_1);\r\n    }\r\n    else if (event & MB_EVENT_HOLDING_REG_RD)\r\n    {\r\n        // \u4e3b\u673a\u8bfb\u53d6\u4fdd\u6301\u5bc4\u5b58\u5668\r\n        ESP_LOGI(TAG, "HOLDING READ");\r\n    }\r\n    else if (event & MB_EVENT_HOLDING_REG_WR)\r\n    {\r\n        // \u4e3b\u673a\u5199\u4fdd\u6301\u5bc4\u5b58\u5668\r\n        ESP_LOGI(TAG, "HOLDING WRITE");\r\n        ESP_LOGI(TAG, "Holding: %d %d", holding_reg_params.holding_0, holding_reg_params.holding_1);\r\n    }\r\n}\r\n\n'})}),"\n",(0,n.jsx)(r.p,{children:"\u611f\u89c9\u505a\u4ece\u673a\u6bd4\u4e3b\u673a\u7b80\u5355\u4e00\u70b9\u3002"}),"\n",(0,n.jsx)(r.p,{children:"\u7b80\u5355\u8dd1\u4e00\u4e2a\u5b9e\u9a8c\uff1a\r\n\u6211\u4eec\u8bbe\u7f6e\u4fdd\u6301\u5bc4\u5b58\u5668\u7684\u4e24\u4e2a\u503c\u4e3a1234\u548c7788"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-c",children:"holding_reg_params_t holding_reg_params = {1234, 7788};\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(3863).A+"",width:"1280",height:"1707"})})]})}function l(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},3863:(e,r,s)=>{s.d(r,{A:()=>n});const n=s.p+"assets/images/modbus_slave_result-bb4660ab421f07f6c16bfb22d23b0700.jpg"},8453:(e,r,s)=>{s.d(r,{R:()=>i,x:()=>a});var n=s(6540);const t={},_=n.createContext(t);function i(e){const r=n.useContext(_);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),n.createElement(_.Provider,{value:r},e.children)}}}]);