"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6366],{137:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>s});var o=r(4848),_=r(8453);const i={},t="\u5982\u4f55\u5728micropython\u4e2d\u6dfb\u52a0C\u5e93",c={id:"espressif/\u4e2a\u4eba\u5b66\u4e60/SoftWare/micropython/esp_micropython\u6dfb\u52a0c\u5e93",title:"\u5982\u4f55\u5728micropython\u4e2d\u6dfb\u52a0C\u5e93",description:"1.\u7f16\u5199c\u9a71\u52a8",source:"@site/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/SoftWare/micropython/esp_micropython\u6dfb\u52a0c\u5e93.md",sourceDirName:"espressif/\u4e2a\u4eba\u5b66\u4e60/SoftWare/micropython",slug:"/espressif/\u4e2a\u4eba\u5b66\u4e60/SoftWare/micropython/esp_micropython\u6dfb\u52a0c\u5e93",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/SoftWare/micropython/esp_micropython\u6dfb\u52a0c\u5e93",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/SoftWare/micropython/esp_micropython\u6dfb\u52a0c\u5e93.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ESP32\u4f7f\u7528micropython",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/SoftWare/micropython/ESP32_micropython"},next:{title:"\u5982\u4f55\u5728micropython\u4e2d\u6dfb\u52a0\u5305\u7ba1\u7406\u5668\u7ec4\u4ef6",permalink:"/docs/espressif/\u4e2a\u4eba\u5b66\u4e60/SoftWare/micropython/esp_micropython\u6dfb\u52a0\u5305\u7ba1\u7406\u5668"}},l={},s=[{value:"1.\u7f16\u5199c\u9a71\u52a8",id:"1\u7f16\u5199c\u9a71\u52a8",level:2},{value:"2.\u7f16\u8bd1\u4e0e\u70e7\u5f55\uff1a",id:"2\u7f16\u8bd1\u4e0e\u70e7\u5f55",level:2},{value:"3.\u6d4b\u8bd5",id:"3\u6d4b\u8bd5",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,_.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"\u5982\u4f55\u5728micropython\u4e2d\u6dfb\u52a0c\u5e93",children:"\u5982\u4f55\u5728micropython\u4e2d\u6dfb\u52a0C\u5e93"}),"\n",(0,o.jsx)(n.h2,{id:"1\u7f16\u5199c\u9a71\u52a8",children:"1.\u7f16\u5199c\u9a71\u52a8"}),"\n",(0,o.jsxs)(n.p,{children:["\u9009\u62e9\u4e00\u4e2a\u76ee\u5f55\uff1a",(0,o.jsx)(n.code,{children:"examples/usercmodule"}),"\uff0c\u5efa\u7acb\u5bf9\u5e94\u7684\u9a71\u52a8\u6587\u4ef6",(0,o.jsx)(n.code,{children:"hw_led"}),"\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:".\r\n\u251c\u2500\u2500 cexample\r\n\u2502   \u251c\u2500\u2500 examplemodule.c\r\n\u2502   \u251c\u2500\u2500 micropython.cmake\r\n\u2502   \u2514\u2500\u2500 micropython.mk\r\n\u251c\u2500\u2500 cppexample\r\n\u2502   \u251c\u2500\u2500 example.cpp\r\n\u2502   \u251c\u2500\u2500 examplemodule.c\r\n\u2502   \u251c\u2500\u2500 examplemodule.h\r\n\u2502   \u251c\u2500\u2500 micropython.cmake\r\n\u2502   \u2514\u2500\u2500 micropython.mk\r\n\u251c\u2500\u2500 hw_led\r\n\u2502   \u251c\u2500\u2500 hw_led.c\r\n\u2502   \u2514\u2500\u2500 hw_led.cmake\r\n\u251c\u2500\u2500 micropython.cmake\r\n\u2514\u2500\u2500 subpackage\r\n    \u251c\u2500\u2500 micropython.cmake\r\n    \u251c\u2500\u2500 micropython.mk\r\n    \u251c\u2500\u2500 modexamplepackage.c\r\n    \u251c\u2500\u2500 qstrdefsexamplepackage.h\r\n    \u2514\u2500\u2500 README.md\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u7167\u7740",(0,o.jsx)(n.code,{children:"usercmodule"}),"\u91cc\u9762\u7684",(0,o.jsx)(n.code,{children:"micropython.cmake"}),"\u6dfb\u52a0\u7f16\u8bd1\u811a\u672c\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cmake",children:"add_library(hw_led INTERFACE)\r\n\r\ntarget_sources(hw_led INTERFACE\r\n    ${CMAKE_CURRENT_LIST_DIR}/hw_led.c\r\n)\r\n\r\ntarget_include_directories(hw_led INTERFACE\r\n    ${CMAKE_CURRENT_LIST_DIR}\r\n)\r\ntarget_link_libraries(usermod INTERFACE hw_led)\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u7f16\u5199led\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5305\u62ec\u521d\u59cb\u5316\uff0c\u5f00\u5173\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:'#include "py/runtime.h"\r\n#include "py/mphal.h"\r\n#include "driver/gpio.h"\r\n\r\nstatic int gpio_num = -1;\r\n\r\nvoid hw_led_init(int num)\r\n{\r\n    gpio_config_t io_conf = {\r\n        .mode = GPIO_MODE_OUTPUT,\r\n        .intr_type = GPIO_INTR_DISABLE,\r\n        .pin_bit_mask = (1ULL << num),\r\n        .pull_down_en = GPIO_PULLDOWN_DISABLE,\r\n        .pull_up_en = GPIO_PULLUP_DISABLE,\r\n    };\r\n    gpio_num = num;\r\n    gpio_config(&io_conf);\r\n}\r\n\r\nvoid hw_led_on(void)\r\n{\r\n    gpio_set_level(gpio_num, 1);\r\n}\r\n\r\nvoid hw_led_off(void)\r\n{\r\n    gpio_set_level(gpio_num, 0);\r\n}\r\n\r\nstatic mp_obj_t led_init_func(mp_obj_t num)\r\n{\r\n    int num_int = mp_obj_get_int(num);\r\n    hw_led_init(num_int);\r\n    return mp_const_none;\r\n}\r\n\r\nstatic MP_DEFINE_CONST_FUN_OBJ_1(led_init_obj, led_init_func);\r\n\r\nstatic mp_obj_t led_on_func(void)\r\n{\r\n    hw_led_on();\r\n    return mp_const_none;\r\n}\r\nstatic MP_DEFINE_CONST_FUN_OBJ_0(led_on_obj, led_on_func);\r\n\r\nstatic mp_obj_t led_off_func(void)\r\n{\r\n    hw_led_off();\r\n    return mp_const_none;\r\n}\r\nstatic MP_DEFINE_CONST_FUN_OBJ_0(led_off_obj, led_off_func);\r\n\r\n\r\nstatic const mp_rom_map_elem_t led_module_globals_table[] = {\r\n    { MP_OBJ_NEW_QSTR(MP_QSTR___name__), MP_OBJ_NEW_QSTR(MP_QSTR_led) },\r\n    { MP_ROM_QSTR(MP_QSTR_init), MP_ROM_PTR(&led_init_obj) },\r\n    { MP_ROM_QSTR(MP_QSTR_on)  , MP_ROM_PTR(&led_on_obj)   },\r\n    { MP_ROM_QSTR(MP_QSTR_off) , MP_ROM_PTR(&led_off_obj)  },\r\n};\r\nstatic MP_DEFINE_CONST_DICT(led_module_globals, led_module_globals_table);\r\n\r\n\r\n// Define module object.\r\nconst mp_obj_module_t led_module = {\r\n    .base = { &mp_type_module },\r\n    .globals = (mp_obj_dict_t *)&led_module_globals,\r\n};\r\n\r\n// Register the module to make it available in Python.\r\nMP_REGISTER_MODULE(MP_QSTR_led, led_module);\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u6709\u51e0\u4e2a\u503c\u5f97\u6ce8\u610f\u7684\u5730\u65b9\uff1a"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"MP_DEFINE_CONST_FUN_OBJ_1"}),"\uff1a\u4ee3\u8868\u51fd\u6570\u53ea\u6709\u4e00\u4e2a\u5f62\u53c2\u3002\u5982\u679c\u662f",(0,o.jsx)(n.code,{children:"MP_DEFINE_CONST_FUN_OBJ_0"}),"\uff0c\u5c31\u4ee3\u8868\u6ca1\u6709\u5f62\u53c2\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"MP_QSTR_led"}),"\uff1a\u4ee3\u8868\u6211\u4eec\u7684\u6a21\u5757\u540d\u5b57\u53ebled\u3002"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"2\u7f16\u8bd1\u4e0e\u70e7\u5f55",children:"2.\u7f16\u8bd1\u4e0e\u70e7\u5f55\uff1a"}),"\n",(0,o.jsx)(n.p,{children:"\u9996\u5148\u8fdb\u5165esp32\u7684\u76ee\u5f55\u4e2d\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"/home/yanke/project/micropython/micropython/ports/esp32\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u7f16\u8bd1\u4ee3\u7801\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"\u279c  esp32 git:(master) \u2717 make USER_C_MODULES=../../../examples/usercmodule/hw_led/hw_led.cmake\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u6ce8\u610f\u8fd9\u91cc\u4e00\u5b9a\u662f\u4e09\u4e2a../\u3002\u6216\u8005\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\uff0c\u56e0\u4e3a\u7f16\u8bd1\u547d\u4ee4\u5e76\u4e0d\u662f\u5728\u5f53\u524d\u76ee\u5f55\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u70e7\u5f55\u4ee3\u7801\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:" python -m esptool --chip esp32 -b 460800 --before default_reset --after hard_reset write_flash --flash_mode dio --flash_size 4MB --flash_freq 40m 0x1000 build-ESP32_GENERIC/bootloader/bootloader.bin 0x8000 build-ESP32_GENERIC/partition_table/partition-table.bin 0x10000 build-ESP32_GENERIC/micropython.bin\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u8fd9\u4e2a\u7f16\u8bd1\u6307\u4ee4\u4f1a\u76f4\u63a5\u6307\u5b9a",(0,o.jsx)(n.code,{children:"/dev/ttyUSB0"}),"\u3002"]}),"\n",(0,o.jsx)(n.h2,{id:"3\u6d4b\u8bd5",children:"3.\u6d4b\u8bd5"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:r(2e3).A+"",width:"1397",height:"614"})})]})}function p(e={}){const{wrapper:n}={...(0,_.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},2e3:(e,n,r)=>{r.d(n,{A:()=>o});const o=r.p+"assets/images/micropython_led\u6d4b\u8bd5-55690883d238314ac3ef172daa31c4fe.png"},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var o=r(6540);const _={},i=o.createContext(_);function t(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(_):e.components||_:t(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);